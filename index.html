<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mister Flappy</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: "Press Start 2P", cursive;
    background: #70c5ce;
  }

  canvas {
    position: absolute;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
  }

  /* MENU */
  #menu {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.4);
    z-index: 2;
    text-align: center;
  }

  #menu h1 {
    font-size: clamp(28px, 6vw, 48px);
    color: #fff;
    margin-bottom: 6vh;
    text-shadow: 4px 4px 0 #000, 0 0 15px #ff6600;
    animation: pulse 2s infinite alternate;
  }

  .menu-btn {
    background: #ff6600;
    color: white;
    border: 3px solid #fff;
    padding: clamp(10px, 2vh, 15px) clamp(25px, 8vw, 50px);
    margin: 2vh;
    cursor: pointer;
    font-size: clamp(12px, 3vw, 18px);
    border-radius: 8px;
    box-shadow: 0 5px #b34700;
    text-transform: uppercase;
    transition: all 0.2s ease;
  }

  .menu-btn:hover { background: #ff8533; transform: scale(1.05); }
  .menu-btn:active { transform: scale(0.95); }

  #dev {
    position: absolute;
    bottom: 2vh;
    font-size: clamp(10px, 2.5vw, 14px);
    color: white;
    text-shadow: 2px 2px 0 #000;
  }

  /* SETUP POPUP */
  #setupPopup {
    display: none;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20,20,20,0.95);
    padding: clamp(15px, 5vw, 30px);
    border-radius: 12px;
    text-align: center;
    color: white;
    border: 3px solid #fff;
    box-shadow: 0 0 20px #ff6600;
    z-index: 3;
    max-width: 90%;
  }

  #setupPopup h2 {
    margin-bottom: 20px;
    color: #ffcc00;
    font-size: clamp(16px, 4vw, 24px);
  }

  .character-card {
    display: inline-block;
    margin: 10px;
    padding: clamp(10px, 3vw, 15px) clamp(15px, 4vw, 20px);
    border: 2px solid #ccc;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.2s, border 0.2s;
    background: rgba(255,255,255,0.1);
    font-size: clamp(12px, 3vw, 16px);
  }

  .character-card:hover { transform: scale(1.05); border: 2px solid #ff6600; }
  .character-card.selected { border: 3px solid #ff6600; background: rgba(255, 102, 0, 0.3); }

  .difficulty { font-size: clamp(8px, 2vw, 12px); margin-top: 5px; color: #ffcc00; }

  /* GAME OVER */
  #gameOverScreen {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.6);
    color: white;
    z-index: 4;
    text-align: center;
    padding: 5vw;
  }

  #gameOverScreen h2 {
    font-size: clamp(18px, 5vw, 28px);
    margin-bottom: 10px;
  }

  #countdown {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: clamp(40px, 12vw, 80px);
    font-weight: bold;
    color: yellow;
    text-shadow: 3px 3px 0 #000;
    display: none;
    z-index: 5;
  }

  #scoreUI {
    position: absolute;
    top: 2vh; left: 2vw;
    color: white;
    font-size: clamp(12px, 3.5vw, 16px);
    text-shadow: 2px 2px 0 #000;
    display: none;
    z-index: 6;
  }

  /* Extra tweak for very small screens */
  @media (max-width: 480px) {
    .menu-btn { width: 70%; }
    .character-card { width: 70%; display: block; margin: 10px auto; }
  }
</style>



</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <!-- MENU -->
  <div id="menu">
    <h1>Mister Flappy</h1>
    <button class="menu-btn" onclick="startCountdown()">Start</button>
    <button class="menu-btn" onclick="openSetup()">Setup</button>
    <button class="menu-btn" onclick="window.close()">Exit</button>
    <div id="dev">Developed by Mr Bhusal</div>
  </div>

  <!-- CHARACTER SETUP -->
  <div id="setupPopup">
    <h2>Choose Your Character</h2>
    <div id="birdCard" class="character-card" onclick="selectCharacter('bird')">
      Bird üê¶
      <div class="difficulty">Easy</div>
    </div>
    <div id="penguinCard" class="character-card" onclick="selectCharacter('penguin')">
      Penguin üêß
      <div class="difficulty">Medium</div>
    </div>
    <div id="robotCard" class="character-card" onclick="selectCharacter('robot')">
      Robot ü§ñ
      <div class="difficulty">Hard</div>
    </div>
    <br><br>
    <button class="menu-btn" onclick="closeSetup()">Close</button>
  </div>

  <!-- SCORE -->
  <div id="scoreUI">
    Score: <span id="score">0</span> | High Score: <span id="highScore">0</span>
  </div>

  <!-- COUNTDOWN -->
  <div id="countdown"></div>

  <!-- GAME OVER -->
  <div id="gameOverScreen">
    <h2 id="finalScore"></h2>
    <p id="highScoreMsg"></p>
    <p>High Score: <span id="displayHighScore"></span></p>
    <button class="menu-btn" onclick="playAgain()">Play Again</button>
    <button class="menu-btn" onclick="restartGame()">Main Menu</button>
  </div>

  <!-- Sounds + Game Script -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  <script>
   const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let charX, charY, charRadius=25;
    function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; charX=canvas.width/4; charY=canvas.height/2;}
    resizeCanvas(); window.addEventListener('resize',resizeCanvas);

    let character=null, gameRunning=false, score=0, highScore=parseInt(localStorage.getItem('highScore'))||0, velocity=0, gravity=0.5, lift=-12, pipes=[], pipeWidth=70, pipeGap=250, spawnCounter=0, frameCount=0;
    let jumpSound, hitSound, scoreSound, bgMusic;

    // Initialize sounds
    hitSound=new Howl({src:['./hit.mp3'],volume:0.5});
    scoreSound=new Howl({src:['./point.mp3'],volume:0.3});
    bgMusic=new Howl({src:['./bgm.mp3'],loop:true,volume:0.2});

    const characters={
      bird:{name:'Bird', poleColor:'#228B22', groundColor:'#32CD32', jumpUrl:'./jump1.mp3',
        draw:function(x,y){
          ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.ellipse(x,y,20,15,0,0,Math.PI*2); ctx.fill();
          const flap=Math.sin(frameCount*0.3)*0.3;
          ctx.save(); ctx.translate(x-8,y+2); ctx.rotate(flap); ctx.fillStyle='#FFA500';
          ctx.beginPath(); ctx.ellipse(0,0,12,8,0,0,Math.PI*2); ctx.fill(); ctx.restore();
          ctx.fillStyle='#FF4500'; ctx.beginPath(); ctx.moveTo(x+18,y); ctx.lineTo(x+28,y-3); ctx.lineTo(x+28,y+3); ctx.closePath(); ctx.fill();
          ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(x+8,y-5,5,0,Math.PI*2); ctx.fill(); ctx.fillStyle='black'; ctx.beginPath(); ctx.arc(x+10,y+5-10,2,0,Math.PI*2); ctx.fill();
        },
        background:function(){
          const grad=ctx.createLinearGradient(0,0,0,canvas.height); grad.addColorStop(0,'#87CEEB'); grad.addColorStop(1,'#E0F6FF'); ctx.fillStyle=grad; ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.fillStyle='rgba(255,255,255,0.8)'; for(let i=0;i<5;i++){ const cloudX=(i*150+frameCount*0.5)%(canvas.width+100)-50; const cloudY=100+i*50; ctx.beginPath(); ctx.arc(cloudX,cloudY,30,0,Math.PI*2); ctx.arc(cloudX+40,cloudY,40,0,Math.PI*2); ctx.arc(cloudX+80,cloudY,30,0,Math.PI*2); ctx.fill();}
          ctx.fillStyle=this.groundColor; ctx.fillRect(0,canvas.height-80,canvas.width,80);
        }
      },
      penguin:{name:'Penguin', poleColor:'#ADD8E6', groundColor:'#F0F8FF', jumpUrl:'./jump2.mp3',
        draw:function(x,y){
          ctx.fillStyle='#000000'; ctx.beginPath(); ctx.ellipse(x,y+10,18,25,0,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='white'; ctx.beginPath(); ctx.ellipse(x,y+15,12,18,0,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='#000000'; ctx.beginPath(); ctx.arc(x,y-5,12,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='white'; ctx.beginPath(); ctx.arc(x-4,y-8,4,0,Math.PI*2); ctx.arc(x+4,y-8,4,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='black'; ctx.beginPath(); ctx.arc(x-2,y-8,2,0,Math.PI*2); ctx.arc(x+6,y-8,2,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='#FFD700'; ctx.beginPath(); ctx.moveTo(x+15,y-2); ctx.lineTo(x+25,y-5); ctx.lineTo(x+25,y+5); ctx.closePath(); ctx.fill();
          ctx.fillStyle='#FF4500'; ctx.beginPath(); ctx.ellipse(x-8,y+30,6,4,0,0,Math.PI*2); ctx.ellipse(x+8,y+30,6,4,0,0,Math.PI*2); ctx.fill();
        },
        background:function(){
          const grad=ctx.createLinearGradient(0,0,0,canvas.height); grad.addColorStop(0,'#A0E7FF'); grad.addColorStop(1,'#B0E0E6'); ctx.fillStyle=grad; ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.fillStyle='#E0FFFF'; for(let i=0;i<4;i++){ const mountainX=(i*200+frameCount*0.3)%(canvas.width+100)-50; ctx.beginPath(); ctx.moveTo(mountainX,canvas.height-80); ctx.lineTo(mountainX+100,canvas.height-200); ctx.lineTo(mountainX+200,canvas.height-80); ctx.fill();}
          ctx.fillStyle=this.groundColor; ctx.fillRect(0,canvas.height-80,canvas.width,80);
          ctx.fillStyle='rgba(255,255,255,0.8)'; for(let i=0;i<50;i++){ const snowX=(i*20+frameCount*0.8)%canvas.width; const snowY=(frameCount*2+i*10)%canvas.height; ctx.beginPath(); ctx.arc(snowX,snowY,2,0,Math.PI*2); ctx.fill();}
        }
      },
      robot:{name:'Robot', poleColor:'#00FFFF', groundColor:'#333333', jumpUrl:'./jump3.mp3',
        draw:function(x,y){
          ctx.fillStyle='#C0C0C0'; ctx.fillRect(x-15,y,30,40); ctx.beginPath(); ctx.arc(x,y-10,12,0,Math.PI*2); ctx.fill();
          ctx.strokeStyle='#FF00FF'; ctx.lineWidth=3; ctx.beginPath(); ctx.moveTo(x-8,y-22); ctx.lineTo(x-8,y-35); ctx.moveTo(x+8,y-22); ctx.lineTo(x+8,y-35); ctx.stroke(); ctx.lineWidth=1;
          ctx.fillStyle='#00FFFF'; ctx.beginPath(); ctx.arc(x-5,y-10,3,0,Math.PI*2); ctx.arc(x+5,y-10,3,0,Math.PI*2); ctx.fill();
          ctx.fillStyle='#C0C0C0'; ctx.fillRect(x-20,y+5,8,15); ctx.fillRect(x+12,y+5,8,15); ctx.fillRect(x-8,y+35,6,15); ctx.fillRect(x+2,y+35,6,15);
          const thrust=Math.sin(frameCount*0.4)>0?'#FF4500':'#C0C0C0'; ctx.fillStyle=thrust; ctx.beginPath(); ctx.ellipse(x-4,y+50,4,8,0,0,Math.PI*2); ctx.ellipse(x+4,y+50,4,8,0,0,Math.PI*2); ctx.fill();
        },
        background:function(){
          ctx.fillStyle='#1a1a2e'; ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.strokeStyle='rgba(0,255,255,0.1)'; ctx.lineWidth=1; for(let i=0;i<canvas.width;i+=50){ctx.beginPath();ctx.moveTo(i,0);ctx.lineTo(i,canvas.height);ctx.stroke();}
          for(let j=0;j<canvas.height;j+=50){ctx.beginPath();ctx.moveTo(0,j);ctx.lineTo(canvas.width,j);ctx.stroke();}
          ctx.fillStyle='#00FFFF'; for(let i=0;i<20;i++){const px=(i*100+frameCount*2)%canvas.width; const py=(frameCount*1.5+i*30)%canvas.height; ctx.beginPath();ctx.arc(px,py,2,0,Math.PI*2);ctx.fill();}
          ctx.fillStyle=this.groundColor; ctx.fillRect(0,canvas.height-80,canvas.width,80);
        }
      }
    };

    function selectCharacter(char){character=characters[char]; jumpSound=new Howl({src:[character.jumpUrl],volume:0.4});
      document.querySelectorAll('.character-card').forEach(c=>c.classList.remove('selected'));
      document.getElementById(char+'Card').classList.add('selected');
      document.getElementById('startBtn').style.display='block';
    }

    function startCountdown(){if(!character) selectCharacter('bird'); document.getElementById('menu').style.display='none';
      const countdownEl=document.getElementById('countdown'); countdownEl.style.display='block'; let count=3;
      countdownEl.textContent=count; const interval=setInterval(()=>{count--; if(count>0){countdownEl.textContent=count;} else{clearInterval(interval);countdownEl.style.display='none'; startGame();}},1000);
    }

    function startGame(){gameRunning=true; score=0; velocity=0; pipes=[]; spawnCounter=0; frameCount=0; charY=canvas.height/2; charX=canvas.width/4;
      document.getElementById('scoreUI').style.display='block'; document.getElementById('score').textContent='0';
      document.getElementById('highScore').textContent=highScore; if(bgMusic) bgMusic.play(); requestAnimationFrame(gameLoop);
    }

    function playAgain(){document.getElementById('gameOverScreen').style.display='none'; startCountdown();}
    function restartGame(){document.getElementById('gameOverScreen').style.display='none'; document.getElementById('menu').style.display='flex';
      document.getElementById('startBtn').style.display='none'; document.querySelectorAll('.character-card').forEach(c=>c.classList.remove('selected'));
      character=null; gameRunning=false; if(bgMusic) bgMusic.stop();
    }

    window.addEventListener('keydown', e=>{ if(e.code==='Space'&&gameRunning){ velocity=lift; if(jumpSound) jumpSound.play(); }});
    canvas.addEventListener('touchstart', e=>{ e.preventDefault(); if(gameRunning){ velocity=lift; if(jumpSound) jumpSound.play(); }});

    function spawnPipe(){ const topHeight=Math.random()*(canvas.height-pipeGap-200)+100; pipes.push({x:canvas.width,topHeight:topHeight,scored:false}); }

    function gameLoop(){
      if(!gameRunning) return; frameCount++; ctx.clearRect(0,0,canvas.width,canvas.height); character.background();
      ctx.fillStyle=character.poleColor; for(let i=pipes.length-1;i>=0;i--){
        const p=pipes[i]; p.x-=5;
        ctx.fillRect(p.x,0,pipeWidth,p.topHeight); ctx.fillRect(p.x,p.topHeight+pipeGap,pipeWidth,canvas.height-p.topHeight-pipeGap);
        if(p.x+pipeWidth<0) {pipes.splice(i,1); continue;}
        const charRight=charX+charRadius; const charLeft=charX-charRadius; const pipeRight=p.x+pipeWidth; const pipeLeft=p.x;
        if(charRight>pipeLeft && charLeft<pipeRight){
          if(charY-charRadius<p.topHeight||charY+charRadius>p.topHeight+pipeGap){gameOver(); return;}
        }
        if(!p.scored && p.x+pipeWidth<charX){score++; p.scored=true; document.getElementById('score').textContent=score; if(scoreSound) scoreSound.play();}
      }

      charY+=velocity; velocity+=gravity; character.draw(charX,charY);
      const groundY=canvas.height-80-charRadius; if(charY>groundY||charY-charRadius<0){gameOver(); return;}
      spawnCounter++; if(spawnCounter%120===0) spawnPipe();
      requestAnimationFrame(gameLoop);
    }

    function gameOver(){gameRunning=false; if(bgMusic) bgMusic.stop(); if(hitSound) hitSound.play();
      document.getElementById('scoreUI').style.display='none'; document.getElementById('gameOverScreen').style.display='flex';
      document.getElementById('finalScore').textContent=`Final Score: ${score}`; document.getElementById('displayHighScore').textContent=highScore;
      const isNewHigh=score>highScore; if(isNewHigh){highScore=score; localStorage.setItem('highScore',highScore);
        document.getElementById('highScoreMsg').style.display='block'; document.getElementById('highScoreMsg').textContent='New High Score! üéâ';}
      else document.getElementById('highScoreMsg').style.display='none';
    }

    document.getElementById('highScore').textContent=highScore;
    function openSetup(){ document.getElementById("setupPopup").style.display="block"; }
    function closeSetup(){ document.getElementById("setupPopup").style.display="none"; }

    // Default state
    window.onload = () => {
      document.getElementById("gameOverScreen").style.display="none";
      document.getElementById("menu").style.display="flex";
    };
  </script>
</body>
</html>
